"use strict";
/*! Wisp https://github.com/lizard-isana/wisp @license MIT */var Willo=Willo||{},scripts=["./lib/js/vendor/markdown-it.js","./lib/js/vendor/markdown-it-task-lists.js","./lib/js/vendor/markdown-it-footnote.js"],len=scripts.length,i=0;function appendScript(){var e=document.createElement("script");e.src=scripts[i],document.getElementsByTagName("head")[0].appendChild(e),++i<len&&(e.onload=appendScript)}appendScript(),Willo.Storage={},Willo.Storage.loaded_page_num=Willo.Storage.loaded_page_num||0,Willo.Storage.GlobalPageLoadHook=[],Willo.DataLoader=function(e){var t;return function(o){if(t=function(){if(t=!1,window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){console&&console.log(e),t=new ActiveXObject("Microsoft.XMLHTTP")}return t}())if(t.open("GET",o.path,o.ajax),t.send(null),0==o.ajax)try{if("json"===o.format)var e=JSON.parse(t.responseText);else e=t.responseText;if(void 0===o.callback)return e;o.callback(e,o.id)}catch(e){return void(console&&console.log(e))}else try{t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){if("json"===o.format)var e=JSON.parse(t.responseText);else e=t.responseText;if(!o.callback)return e;console.log(),o.callback(e,o.id)}}}catch(e){return void(console&&console.log(e))}}(e)},Willo.QueryDecoder=function(){for(var e=[],o=decodeURIComponent(location.search).replace(/^\?/,"&").split("&"),t=1,n=o.length;t<n;t++){var i=o[t].split("="),r=i[0],a=i[1];"true"===a?a=!0:"false"===a&&(a=!1),e[r]=a}return e},Willo.Wisp=Willo.Wisp||function(e,o){function a(e,t,n){u.loaded_data_num=0;var i=e.length,o=!0,r=!1,a=void 0;try{for(var l,d=e[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var s=l.value;new Willo.DataLoader({format:"text",path:s+"?nocache="+(new Date).getTime(),id:s,ajax:!0,callback:function(e,o){t[o]=e;new _(i,n)}})}}catch(e){r=!0,a=e}finally{try{o||null==d.return||d.return()}finally{if(r)throw a}}}var t,u={},_=function(e,o){u.loaded_data_num+=1,u.loaded_data_num==e&&o()};u.PreRenderingHook=[],this.add_pre_rendering_hook=function(e){u.PreRenderingHook.push(e)},u.CodeHighlightHook=[],this.add_code_highlight_hook=function(e){u.CodeHighlightHook.push(e)},u.PostRenderingHook=[],this.add_post_rendering_hook=function(e){u.PostRenderingHook.push(e)},u.PostContentLoadHook=[],this.add_post_content_load_hook=function(e){u.PostContentLoadHook.push(e)},u.PostPageLoadHook=[],this.add_post_page_load_hook=function(e){u.PostPageLoadHook.push(e)},this.id=e,this.load_page=function(e){var o=Willo.QueryDecoder();u.contents={};var p=[];if(0<Object.keys(o).length)for(var t in o)if(t==u.element_id){p=[];var n=o[t].split(",");for(var i in n){var r=n[i].split("/").reverse()[0];p.push(r)}}else p=e;else p=e;if(Willo.Storage.loaded_page_num+=p.length,0<p.length)new a(p,u.contents,function(e){var o=[];for(var t in p){var n=p[t];o.push(u.contents[n])}var i=o.join("\n");if(0<u.PreRenderingHook.length)for(var r in u.PreRenderingHook)i=u.PreRenderingHook[r](u.element_id,i);if("raw"==u.format)document.getElementById(u.element_id).innerHTML=i;else{var a=u.Renderer.render(i);if(0<u.PostRenderingHook.length)for(var l in u.PostRenderingHook)a=u.PostRenderingHook[l](u.element_id,a);document.getElementById(u.element_id).innerHTML=a;for(var d=document.getElementById(u.element_id).querySelectorAll("a"),s=0,_=d.length;s<_;s++){var c=d[s].getAttribute("href");c.match(/^(?!http(|s))/)&&c.match(/^(?!.*(\/|=)).*/)&&(d[s].href="?"+u.inner_link_target+"="+c)}}if(0<u.PostContentLoadHook.length)for(var g in u.PostContentLoadHook)u.PostContentLoadHook[g](u.element_id,a);if(Willo.Storage.display_page_num=Willo.Storage.display_page_num||0,Willo.Storage.display_page_num++,Willo.Storage.display_page_num==Willo.Storage.loaded_page_num)for(var h in u.PostPageLoadHook)u.PostPageLoadHook[h]()})},t=o,u.Renderer=window.markdownit({html:!0,breaks:!0,linkify:!0,typographer:!0,highlight:function(e,o){if(0<u.CodeHighlightHook.length)for(var t in u.CodeHighlightHook)e=u.CodeHighlightHook[t](u.element_id,e,o);return e}}).use(markdownitFootnote).use(markdownitTaskLists),u.Renderer.linkify.set({fuzzyLink:!1}),u.format="markdown",u.permit_query=!0,u.query_path="./",u.element_id=e,u.inner_link_target=e,t&&(t.format&&(u.format=format),t.query&&(u.permit_query=t.query,t.query_path&&(u.query_path=t.query_path)),t.inner_link_target&&(u.inner_link_target=t.inner_link_target)),this.renderer=u.Renderer},Willo.Wisp.prototype={pre_rendering_hook:function(e){this.add_pre_rendering_hook(e)},code_highlight_hook:function(e){this.add_code_highlight_hook(e)},post_rendering_hook:function(e){this.add_post_rendering_hook(e)},post_content_load_hook:function(e){this.add_post_content_load_hook(e)},post_page_load_hook:function(e){this.add_post_page_load_hook(e)},load:function(e){if(Array.isArray(e))var o=e;else if("string"==typeof e)o=[e];else o=["index.md"];this.load_page(o)}};var Wisp=Willo.Wisp;